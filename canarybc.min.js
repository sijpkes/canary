function getElementIndex(e,n){var a=0;__J(n).each(function(n){return current=__J(this).text().length(),a+=current,a>e?n:void 0})}function run(e,n){clearTimeout(domc),console.log("Running scan..."),0===__J("#plagcheck").length&&__J("body").append('<div id="plagcheck"></div>');var a=e.split(" "),t=[],r=0,c="";console.log("PARTS: "+a),e.length>55&&(__J(a).each(function(){c.length<55?c+=" "+this:(t[r]=c.replace(/\s+/g," "),r++,c=this)}),t.length<1&&a.length>0&&(t[0]={index:0,value:c})),search(t,n),domc=setTimeout("checkDOMChanged(true)",1e3)}function checkDOMChanged(e){"undefined"==typeof e&&(e=!1),canary.ifr=__J("#blogEntry_desc_text_ifr").contents(),canary.tmceContent=__J(canary.ifr).find("#tinymce").contents();var n=__J(canary.tmceContent).text();n=removeQuotedText(n),canary.rawContent=__J(canary.tmceContent).text();var a=__J(canary.ifr).find("#tinymce").find("*");e===!0&&(lastStr=n,console.log("Resetting check...")),lastStr!=n&&(console.log("unwrapping"),__J(canary.tmceContent).find(".canned").contents().unwrap(),run(n,a),lastStr=n),domc=setTimeout("checkDOMChanged(false)",1e3)}function removeQuotedText(e){var n;if(-1!==e.indexOf('"'))n=e.split('"');else{if(-1===e.indexOf("“")||-1===e.indexOf("”"))return e;n=e.split("[“”]")}for(var a=1;a<n.length;a+=2)delete n[a];return e=n.join("")}function parseResult(e,n,a){if("undefined"!=typeof n){var t=("string"==typeof n?JSON.parse(n):n,""),r=n[0];if(canary.prevLink=r.link,"undefined"==typeof r)return void console.log("No results");console.log(r),parseFloat(r.perc)>20&&(t="#FFCBA4"),parseFloat(r.perc)>50&&(t="orange"),parseFloat(r.perc)>80&&(t="red");var c=[];""!=t&&__J(a).each(function(e,n){if(c.push(n),-1==c.indexOf(__J(this).parent())){var a=__J(n).text();if(a.length>0){var o=a.replace(/\s+/g,""),s=r.phrase.replace(/\s+/g,""),l=o.indexOf(s);if(-1!=l){var i="_can"+e;if(0==__J(n).find("a#_cananch"+i).length){var d=__J("<a/>");__J(d).attr("href","#").attr("id","_cananch"+i).addClass("canned").css("color",t),__J(n).attr("id",i).contents().wrap(d)}var h=__J(n).attr("title")?__J(n).attr("title"):"";-1==h.indexOf(r.displayLink)&&(h+=Math.floor(r.perc)+"% match with "+r.displayLink+"\n"),__J(n).attr("title",h)}}}})}}function search(e,n){var a="undefined"!=typeof canary.prevLink&&canary.prevLink.length>0?"&pdl="+encodeURIComponent(canary.prevLink):"";__J.ajax({url:base+"p_search.php?q="+encodeURIComponent(e[searchIndex])+a,type:"GET",async:!1,dataType:"jsonp",jsonpCallback:"check",success:function(a){console.log(a),"undefined"!=typeof a.results&&(parseResult(e[searchIndex],a.results,n),searchIndex++,searchIndex<e.length?search(e,n):searchIndex=0)},error:function(){alert("Error")}})}var canary=canary?canary:{},lastStr="",lastSearchedStr="",domc=null,searchIndex=0;canary.markMap=[],__J(".textboxtable").bind("mouseover","body#tinymce",function(){null===domc?(domc=setTimeout("checkDOMChanged(false)",1e3),console.log("dom checker attached")):__J(".textboxtable body#tinymce").unbind("mouseover")});
//# sourceMappingURL=canarybc.min.js.map
